<!--
	<H3>The fireflies application descriptor</H3>

	It can be started to launch a ringproxy scenario.
-->

<applicationtype xmlns="http://jadex.sourceforge.net/jadex"
	xmlns:env="http://jadex.sourceforge.net/jadex-envspace"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://jadex.sourceforge.net/jadex 
	                    http://jadex.sourceforge.net/jadex-application-2.5.xsd
	                    http://jadex.sourceforge.net/jadex-envspace 
	                    http://jadex.sourceforge.net/jadex-envspace-2.5.xsd"
	name="DhtRingViewer" package="jadex.micro.examples.dhtringviewer">
	
	<imports>
		<import>jadex.extension.envsupport.environment.space2d.action.*</import>
		<import>jadex.extension.envsupport.environment.space2d.*</import>
		<import>jadex.extension.envsupport.environment.*</import>
		<import>jadex.extension.envsupport.math.*</import>
		<import>jadex.extension.envsupport.dataview.*</import>
		<import>jadex.extension.envsupport.observer.perspective.*</import>
		<import>jadex.bdi.planlib.*</import>
		<import>jadex.extension.envsupport.evaluation.*</import>
		<import>jadex.commons.*</import>
		<import>jadex.commons.future.*</import>
		<import>jadex.extension.envsupport.observer.gui.plugin.*</import>
		<import>java.awt.*</import>
	</imports>
	
	<arguments>
	</arguments>
	
	<extensiontypes>
		<env:envspacetype name="gc2dspace" width="30" height="30" class="ContinuousSpace2D">
			<env:property name="hash">-1</env:property>
			
			<env:objecttypes>
				<env:objecttype name="ringproxy" kdtree="true">
			    	<env:property name="successorDistance">0.0</env:property>
			    	<env:property name="successorRotation">0.0</env:property>
<!-- 			    	<env:property name="connectionVectorMove">new Vector2Double(0.0,0.0)</env:property> -->
			    	<env:property name="connectionVector">new Vector2Double(0.0,0.0)</env:property>
<!-- 				    <env:property name="pointerRotation" class="Vector3Double">new Vector3Double()</env:property> -->
				</env:objecttype>
				
			</env:objecttypes>
			
			<env:dataviews>
				<env:dataview name="view_all" class="GeneralDataView2D" />
			</env:dataviews>
			
			<env:avatarmappings>
				<env:avatarmapping componenttype="RingProxy" objecttype="ringproxy" createavatar="true" createcomponent="false"/>
			</env:avatarmappings>
		
			<env:actiontypes>
				<env:actiontype name="move" class="MoveAction" />
			</env:actiontypes>
		
			<env:perspectives>
				<env:perspective name="icon" class="Perspective2D" objectplacement="center">
				        
					<env:drawable objecttype="ringproxy" width="1.0" height="1.0">
<!-- 						<env:property name="color" dynamic="true">$object.flashing? Color.YELLOW: Color.gray</env:property> -->
						<env:property name="color" dynamic="false">Color.black</env:property>
						<env:property name="lineColor" dynamic="false">Color.blue</env:property>
						
						<env:property name="hash" dynamic="true">$object.hash</env:property>
						
<!-- 						<env:property name="pointerSize" dynamic="true">new Vector2Double($object.successorDistance,0.03)</env:property> -->
						<env:property name="pointerSize" dynamic="true">new Vector2Double($object.connectionVector.getLength().getAsDouble(),0.03)</env:property>
						
						<env:property name="pointerRotation" dynamic="true">new Vector3Double(0, 0, $object.successorRotation)</env:property>
						<env:property name="pointerEndRotation" dynamic="true">new Vector3Double(0, 0, $object.successorRotation-Math.PI/6)</env:property>
						
						<env:property name="pointerPos" dynamic="true">$object.connectionVector.copy().multiply(0.5).add($object.connectionVector.copy().normalize().multiply(0.5))</env:property>
						
						<env:property name="pointerEndPos" dynamic="true">$object.connectionVector.copy().add($object.connectionVector.copy().normalize().multiply(0.25))</env:property>
<!-- 						<env:property name="rotation" dynamic="true"> -->
<!-- 							new Vector3Double(0,0,$object.direction) -->
<!-- 						</env:property> -->
<!-- 						<env:texturedrectangle layer="2" color="color" rotation="rotation" width="0.8" height="0.8" imagepath="jadex/micro/examples/fireflies/images/bug.png" /> -->
						<!-- <env:ellipse color="color" width="1.0" height="1.0">
							<env:drawcondition>$object.flashing</env:drawcondition>
						</env:ellipse> -->
						<env:ellipse layer="0" width="1" height="1" color="#CCCCCCFF"/>
						<env:text x="-0.5" y="0" text="$hash" color="#000000FF"/>
<!-- 						<env:rectangle layer="-1" width="2" height="2" color="#ff00007f" />  -->
						<env:rectangle layer="1" position="pointerPos" size="pointerSize" rotation="pointerRotation" color="lineColor"/>
						<env:triangle layer="2" position="pointerEndPos" color="lineColor" rotation="pointerEndRotation" width="0.5" height="0.5">
						    <env:drawcondition>$object.successorHash != null</env:drawcondition>
					    </env:triangle>
					</env:drawable>
					
					<env:prelayers>
						<env:colorlayer color="white"/>
					</env:prelayers>
				</env:perspective>
				
				<env:perspective name="abstract" class="Perspective2D" objectplacement="center">
					<env:drawable objecttype="ringproxy" width="1.0" height="1.0">
						<env:property name="color" dynamic="true">Color.white</env:property>
<!-- 						<env:property name="rotation" dynamic="true"> -->
<!-- 							// the triangle must be turned upwards-down -->
<!-- 							new Vector3Double(0,0,$object.direction+Math.PI) -->
<!-- 						</env:property> -->
<!-- 						<env:triangle color="color" rotation="rotation" width="1.0" height="1.0"> -->
<!-- 							<env:drawcondition>$space.show_dark_flies || $object.flashing</env:drawcondition> -->
<!-- 						</env:triangle> -->
						<env:rectangle layer="1" width="3" height="3" color="#ff00007f" /> <!-- red -->
					</env:drawable>
					<env:prelayers>
						<env:colorlayer color="black"/>
					</env:prelayers>
				</env:perspective>
			</env:perspectives>
			
			<env:spaceexecutor class="RoundBasedExecutor">
				<env:property name="space">$space</env:property>
			</env:spaceexecutor>
		</env:envspacetype>
	</extensiontypes>
	
	<componenttypes>
		<componenttype name="RingProxy" filename="jadex/micro/examples/dhtringviewer/RingProxyAgent.class"/>
		<componenttype name="RingProxyCreator" filename="jadex/micro/examples/dhtringviewer/RingProxyCreatorAgent.class"/>
	</componenttypes>
	
	<services>
	    <providedservice class="jadex.extension.envsupport.IEnvironmentService">
	        <implementation class="jadex.extension.envsupport.EnvironmentService"/>
	    </providedservice>
	</services>
	
	<configurations>	
		<configuration name="15x15 and 500 flies, kd-tree enabled">
			<arguments>
			</arguments>
			
			<extensions>
				<env:envspace name="mygc2dspace" type="gc2dspace" width="15" height="15">
					
					<env:dataproviders>
						<env:dataprovider name="flashes">
							<env:source name="$flies" objecttype="ringproxy" aggregate="true">
<!-- 								<env:includecondition>$object.flashing</env:includecondition> -->
							</env:source>
							<env:data name="time">$time</env:data>
							<env:data name="number_flashes">$flies.size()</env:data>
						</env:dataprovider>
					</env:dataproviders>
			
<!-- 					<env:dataconsumers> -->
<!-- 						<env:dataconsumer name="flashes_chart" class="XYChartDataConsumer"> -->
<!-- 							<env:property name="dataprovider">"flashes"</env:property> -->
<!-- 							<env:property name="title">"Number of flashing flies"</env:property> -->
<!-- 							<env:property name="labelx">"Time"</env:property> -->
<!-- 							<env:property name="labely">"Flashes"</env:property> -->
<!-- 							<env:property name="maxitemcount">500</env:property> -->
<!-- 							<env:property name="legend">false</env:property> -->
							
<!-- 							Defines a normal series. -->
<!-- 							<env:property name="seriesname">"Flashes"</env:property> -->
<!-- 							<env:property name="valuex">"time"</env:property> -->
<!-- 							<env:property name="valuey">"number_flashes"</env:property> -->
<!-- 						</env:dataconsumer> -->
<!-- 					</env:dataconsumers> -->
				
					<env:observers>
						<env:observer name="world" dataview="view_all" perspective="main">
<!-- 							<env:plugin name="evaluation" class="EvaluationPlugin"> -->
<!-- 								<env:property name="component_0">((AbstractChartDataConsumer)$space.getDataConsumer("flashes_chart")).getChartPanel()</env:property> -->
<!-- 							</env:plugin> -->
						</env:observer>
					</env:observers>
				</env:envspace>
			</extensions>

			<components>
<!-- 				<component name="&quot;Ringproxy#&quot;+$n" type="RingProxy" number="0"/> -->
				<component name="&quot;RingproxyCreator#&quot;+$n" type="RingProxyCreator" number="1"/>
			</components>
		</configuration>
		
		
	</configurations>

</applicationtype>
