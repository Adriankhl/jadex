<?xml version="1.0"?>

<project name="javaflow instrumentation" default="javaflow_rewrite" basedir=".">

		<!-- 
	    BCEL is currently lacking some forward development. In order to support 
	    JDK 1.5 and up BCEL needs some internal refactorings. The first step 
	    would be to define the areas that need to change and to define a roadmap. 
	    As a second step support for jdk 1.5 should be implemented.
		Torsten Curdt (tcurdt at apache dot org) 
		Source: http://wiki.apache.org/general/SummerOfCode2006
	     -->
	
	<!-- mode: [ bcel | asm ] -->
	<property name="mode"						value="bcel" /> 
	<property name="javaflow.dir"				value="${basedir}/../../commons-javaflow" /> 

	<property name="kernel-bdi.dir"				value="${basedir}/../jadex-kernel-bdi" />
	<property name="kernel-bdi-cont.dir"		value="${basedir}" />
	<property name="kernel-micro.dir"			value="${basedir}/../jadex-kernel-micro" />
	
	<property name="javaparser.dir"				value="${basedir}/../jadex-javaparser" /> 
	<property name="bridge.dir"					value="${basedir}/../jadex-bridge" />
	<property name="commons.dir"				value="${basedir}/../jadex-commons" />
	<property name="rules.dir"					value="${basedir}/../jadex-rules" />
	
	<property name="applib-bdi.dir"				value="${basedir}/../jadex-applib-bdi" />
	<property name="runtimetools.dir"			value="${basedir}/../jadex-runtimetools" />
	<property name="applications-bdi.dir"		value="${basedir}/../jadex-applications-bdi" />
	<property name="applications-bdi-cont.dir"	value="${basedir}/../jadex-applications-bdi" />
	
	<property name="classes"					value="/target/classes" />
	
	
	<path id="javaflow.classpath">
		<!-- javaflow -->
		<pathelement path="${javaflow.dir}/target/javaflow-1.0-SNAPSHOT.jar" />
		<fileset dir="${javaflow.dir}/lib" includes="**/*.jar" />
		<!-- javaparser -->
		<pathelement path="${javaparser.dir}${classes}"  />
		<!-- commons -->
		<pathelement path="${commons.dir}${classes}"/>
		<!-- bridge -->
		<pathelement path="${bridge.dir}${classes}"/>
		<!-- kernel -->
		<pathelement path="${kernel-bdi.dir}${classes}"/>
		<!-- rules -->
		<pathelement path="${rules.dir}${classes}"/>
		<!-- applib -->
		<fileset dir="${applib-bdi.dir}/lib" includes="**/*.jar" />
		<pathelement path="${applib-bdi.dir}${classes}"/>
		<!-- runtime tools -->
		<pathelement path="${runtimetools.dir}${classes}"/>
	</path>

	<taskdef name="javaflow" classname="org.apache.commons.javaflow.ant.AntRewriteTask">
		<classpath refid="javaflow.classpath" />	  
	</taskdef>

	<!-- set up the build environment -->
	<target name="setup">
		<!--
		<mkdir dir="${output.dir}"/>
		-->
	</target>
	
	<target name="javaflow_rewrite" depends="setup" description="Apply javaflow bytecode-instrumentation" >
	    <echo message="Applying Javaflow instrumentation" level="info" />

		<!--
		<javaflow mode="${mode}" srcdir="${kernel-bdi.dir}${classes}" destdir="${kernel-bdi.dir}${classes}">
			<include name="**/*.class" />
		</javaflow>
		-->
		
		<javaflow mode="${mode}" srcdir="${kernel-bdi-cont.dir}${classes}" destdir="${kernel-bdi-cont.dir}${classes}">
			<include name="**/continuation/**/*.class" />
		</javaflow>
		
		<!-- overwrite bdi kernel classes! - ->
		<javaflow mode="${mode}" srcdir="${kernel-bdi-cont.dir}${classes}" destdir="${kernel-bdi.dir}${classes}">
			<include name="**/*.class" />
		</javaflow>
		-->
		
		<!--
		<javaflow mode="${mode}" srcdir="${applib-bdi.dir}${classes}" destdir="${applib-bdi.dir}${classes}">
			<include name="**/*.class" />
		</javaflow>
		-->
		
		<!--
		<javaflow mode="${mode}" srcdir="${runtimetools.dir}${classes}" destdir="${runtimetools.dir}${classes}">
			<include name="**/*.class" />
		</javaflow>
		-->
		
		<!--
		<javaflow mode="${mode}" srcdir="${applications-bdi.dir}${classes}" destdir="${applications-bdi.dir}${classes}">
			<include name="**/*.class" />
		</javaflow>
		-->
		
		<javaflow mode="${mode}" srcdir="${applications-bdi-cont.dir}${classes}" destdir="${applications-bdi-cont.dir}${classes}">
			<include name="**/*.class" />
		</javaflow>
		
	</target>

</project>