<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<MASDynamic name="marsWorldWithCoordSpace">
	<!--
		Responsible for the coordination within the MarsWorld.
	-->

	<!--
		System Properties: Definitions of the behaviors that agents can adopt
		and that makes them: - engage in coordinative activities - react to
		coordinative activities
	-->
	<system_properties>
		<role_occupations>
		<!-- The roles required for the coordination of new detected targets. -->
			<role_occupation name="target_seen_sender" multiple="false">
				<agent id="Producer" />
				<agent id="Carry" />								
			</role_occupation>
			<role_occupation name="target_seen_receiver" multiple="false">
				<agent id="Sentry" />										
			</role_occupation>
			<!-- The roles required for the coordination of analyzed targets. -->
			<role_occupation name="target_analyzed_sender" multiple="false">
				<agent id="Sentry" />												
			</role_occupation>
			<role_occupation name="target_analyzed_receiver" multiple="false">
				<agent id="Producer" />										
			</role_occupation>
			<!-- The roles required for the coordination of produced targets. -->
			<role_occupation name="target_produced_sender" multiple="false">
				<agent id="Producer" />												
			</role_occupation>
			<role_occupation name="target_produced_receiver" multiple="false">
				<agent id="Carry" />										
			</role_occupation>
		</role_occupations>
	</system_properties>


	<!--
		Causal links: Definition of the interdependencies between
		agent-behaviors.
	-->
	<causalities>
		<deco_links>
			<!-- The link, where the producer/carry inform the sentry about the latest detected target. -->
			<deco_link realization="latest_target_seen_proximity" type="POSITIVE" name="target_seen_send-receive-proximity" spaces="mycoordspace">
				<froms>
					<from>target_seen_sender</from>
				</froms>
				<tos>
					<to>target_seen_receiver</to>
				</tos>
			</deco_link>			
			<!-- The link, where the sentry informs the producer about the latest analyzed target. -->
			<deco_link realization="latest_target_analyzed_proximity" type="POSITIVE" name="target_analyzed_send-receive-proximity" spaces="mycoordspace">
				<froms>
					<from>target_analyzed_sender</from>
				</froms>
				<tos>
					<to>target_analyzed_receiver</to>
				</tos>
			</deco_link>
			<!-- The link, where the producer informs the carry about the latest produced target. -->
			<deco_link realization="latest_target_produced_proximity" type="POSITIVE" name="target_produced_send-receive-proximity" spaces="mycoordspace">
				<froms>
					<from>target_produced_sender</from>
				</froms>
				<tos>
					<to>target_produced_receiver</to>
				</tos>
			</deco_link>
			<!-- The link, where the producer/carry inform the sentry about the latest detected target. -->
			<deco_link realization="latest_target_seen_broadcast" type="POSITIVE" name="target_seen_send-receive-broadcast" spaces="mycoordspace">
				<froms>
					<from>target_seen_sender</from>
				</froms>
				<tos>
					<to>target_seen_receiver</to>
				</tos>
			</deco_link>			
			<!-- The link, where the sentry informs the producer about the latest analyzed target. -->
			<deco_link realization="latest_target_analyzed_broadcast" type="POSITIVE" name="target_analyzed_send-receive-broadcast" spaces="mycoordspace">
				<froms>
					<from>target_analyzed_sender</from>
				</froms>
				<tos>
					<to>target_analyzed_receiver</to>
				</tos>
			</deco_link>
			<!-- The link, where the producer informs the carry about the latest produced target. -->
			<deco_link realization="latest_target_produced_broadcast" type="POSITIVE" name="target_produced_send-receive-broadcast" spaces="mycoordspace">
				<froms>
					<from>target_produced_sender</from>
				</froms>
				<tos>
					<to>target_produced_receiver</to>
				</tos>
			</deco_link>
		</deco_links>

		<!-- The detailed configuration of interdependency enactment. -->
		<deco-link-realizations>
		<!-- The link, where the producer/carry inform the sentry about the latest detected target. -->
			<realization id="latest_target_seen_proximity">
				<from>		<!-- Published behaviors / events: -->					
					<!-- <agent_element element="latest_target" agent_id="Producer" type="BDI_BELIEFSET">-->
					<agent_element element="callSentryEvent" agent_id="Producer" type="INTERNAL_EVENT">					
						<parameter_mappings>
							<mapping ref="latest_target" name="latest_target"/>
						</parameter_mappings>
					</agent_element>
					<!-- <agent_element element="latest_target" agent_id="Carry" type="BDI_BELIEFSET">-->
					<agent_element element="callSentryEvent" agent_id="Carry" type="INTERNAL_EVENT">
						<parameter_mappings>
							<mapping ref="latest_target" name="latest_target"/>
						</parameter_mappings>
					</agent_element>
				</from>
				<!-- Coordination Medium configuration: -->
				<mechanism_configuration
					mechanism_id="sodekovs.marsworld.coordination.ProximityMechanism"
					agent_type="JADEX">
					<properties>
						<entry>
							<key>proximity</key>
							<value>0.25</value>
						</entry>
					</properties>
				</mechanism_configuration>			
				<to>		<!-- Behaviors / events to be triggered upon reception: -->				
					 <!-- <agent_element element="addTargetPlan" agent_id="Sentry" type="BDI_PLAN">-->
					 <agent_element element="latestTargetEvent" agent_id="Sentry" type="INTERNAL_EVENT">
						<parameter_mappings>
							<mapping ref="latest_target" name="latest_target"/>
						</parameter_mappings>
					</agent_element>
				</to>
				<active>true</active>
			</realization>
			
			<!-- The link, where the sentry informs the producer about the latest analyzed target. -->
			<realization id="latest_target_analyzed_proximity">
				<from>		<!-- Published behaviors / events: -->					
					<agent_element element="callProducerEvent" agent_id="Sentry" type="INTERNAL_EVENT">
					 <!-- <agent_element element="callProducerAgentPlan" agent_id="Sentry" type="BDI_PLAN">-->
						<parameter_mappings>
							<mapping ref="latest_analyzed_target" name="latest_analyzed_target"/>
						</parameter_mappings>
					</agent_element>					
				</from>
				<!-- Coordination Medium configuration: -->				
				<mechanism_configuration
					mechanism_id="sodekovs.marsworld.coordination.ProximityMechanism"
					agent_type="JADEX">
					<properties>
						<entry>
							<key>proximity</key>
							<value>0.25</value>
						</entry>
					</properties>
				</mechanism_configuration>	
				<to>		<!-- Behaviors / events to be triggered upon reception: -->				
					 <!-- <agent_element element="latest_analyzed_target" agent_id="Producer" type="BDI_BELIEFSET">-->
					 <agent_element element="latestAnalyzedTargetEvent" agent_id="Producer" type="INTERNAL_EVENT">
						<parameter_mappings>
							<mapping ref="latest_analyzed_target" name="latest_analyzed_target"/>
						</parameter_mappings>
					</agent_element>
				</to>
				<active>true</active>
			</realization>
			
			<!-- The link, where the producer informs the carry about the latest produced target. -->
			<realization id="latest_target_produced_proximity">
				<from>		<!-- Published behaviors / events: -->					
					<!-- <agent_element element="latest_produced_target" agent_id="Producer" type="BDI_BELIEFSET">-->
					<agent_element element="callCarryEvent" agent_id="Producer" type="INTERNAL_EVENT">
						<parameter_mappings>
							<mapping ref="latest_produced_target" name="latest_produced_target"/>
						</parameter_mappings>
					</agent_element>					
				</from>
				<!-- Coordination Medium configuration: -->				
				<mechanism_configuration
					mechanism_id="sodekovs.marsworld.coordination.ProximityMechanism"
					agent_type="JADEX">
					<properties>
						<entry>
							<key>proximity</key>
							<value>0.25</value>
						</entry>
					</properties>
				</mechanism_configuration>	
				<to>		<!-- Behaviors / events to be triggered upon reception: -->									 
					 <!-- <agent_element element="latest_produced_target" agent_id="Carry" type="BDI_BELIEFSET"> -->
					 <agent_element element="latestProducedTargetEvent" agent_id="Carry" type="INTERNAL_EVENT">					 
						<parameter_mappings>
							<mapping ref="latest_produced_target" name="latest_produced_target"/>
						</parameter_mappings>
					</agent_element>
				</to>
				<active>true</active>
			</realization>
		
		<!-- The link, where the producer/carry inform the sentry about the latest detected target. -->
			<realization id="latest_target_seen_broadcast">
				<from>		<!-- Published behaviors / events: -->					
					<!-- <agent_element element="latest_target" agent_id="Producer" type="BDI_BELIEFSET">-->
					<agent_element element="callSentryEvent" agent_id="Producer" type="INTERNAL_EVENT">					
						<parameter_mappings>
							<mapping ref="latest_target" name="latest_target"/>
						</parameter_mappings>
					</agent_element>
					<!-- <agent_element element="latest_target" agent_id="Carry" type="BDI_BELIEFSET">-->
					<agent_element element="callSentryEvent" agent_id="Carry" type="INTERNAL_EVENT">
						<parameter_mappings>
							<mapping ref="latest_target" name="latest_target"/>
						</parameter_mappings>
					</agent_element>
				</from>
				<!-- Coordination Medium configuration: -->
				<mechanism_configuration
					mechanism_id="sodekovs.marsworld.coordination.BroadcastMechanism"
					agent_type="JADEX">
				</mechanism_configuration>			
				<to>		<!-- Behaviors / events to be triggered upon reception: -->				
					 <!-- <agent_element element="addTargetPlan" agent_id="Sentry" type="BDI_PLAN">-->
					 <agent_element element="latestTargetEvent" agent_id="Sentry" type="INTERNAL_EVENT">
						<parameter_mappings>
							<mapping ref="latest_target" name="latest_target"/>
						</parameter_mappings>
					</agent_element>
				</to>
				<active>false</active>
			</realization>
			
			<!-- The link, where the sentry informs the producer about the latest analyzed target. -->
			<realization id="latest_target_analyzed_broadcast">
				<from>		<!-- Published behaviors / events: -->					
					<agent_element element="callProducerEvent" agent_id="Sentry" type="INTERNAL_EVENT">
					 <!-- <agent_element element="callProducerAgentPlan" agent_id="Sentry" type="BDI_PLAN">-->
						<parameter_mappings>
							<mapping ref="latest_analyzed_target" name="latest_analyzed_target"/>
						</parameter_mappings>
					</agent_element>					
				</from>
				<!-- Coordination Medium configuration: -->				
				<mechanism_configuration
					mechanism_id="sodekovs.marsworld.coordination.BroadcastMechanism"
					agent_type="JADEX">
				</mechanism_configuration>	
				<to>		<!-- Behaviors / events to be triggered upon reception: -->				
					 <!-- <agent_element element="latest_analyzed_target" agent_id="Producer" type="BDI_BELIEFSET">-->
					 <agent_element element="latestAnalyzedTargetEvent" agent_id="Producer" type="INTERNAL_EVENT">
						<parameter_mappings>
							<mapping ref="latest_analyzed_target" name="latest_analyzed_target"/>
						</parameter_mappings>
					</agent_element>
				</to>
				<active>false</active>
			</realization>
			
			<!-- The link, where the producer informs the carry about the latest produced target. -->
			<realization id="latest_target_produced_broadcast">
				<from>		<!-- Published behaviors / events: -->					
					<!-- <agent_element element="latest_produced_target" agent_id="Producer" type="BDI_BELIEFSET">-->
					<agent_element element="callCarryEvent" agent_id="Producer" type="INTERNAL_EVENT">
						<parameter_mappings>
							<mapping ref="latest_produced_target" name="latest_produced_target"/>
						</parameter_mappings>
					</agent_element>					
				</from>
				<!-- Coordination Medium configuration: -->				
				<mechanism_configuration
					mechanism_id="sodekovs.marsworld.coordination.BroadcastMechanism"
					agent_type="JADEX">
					<properties>
						<entry>
							<key>proximity</key>
							<value>0.25</value>
						</entry>
					</properties>
				</mechanism_configuration>	
				<to>		<!-- Behaviors / events to be triggered upon reception: -->									 
					 <!-- <agent_element element="latest_produced_target" agent_id="Carry" type="BDI_BELIEFSET"> -->
					 <agent_element element="latestProducedTargetEvent" agent_id="Carry" type="INTERNAL_EVENT">					 
						<parameter_mappings>
							<mapping ref="latest_produced_target" name="latest_produced_target"/>
						</parameter_mappings>
					</agent_element>
				</to>
				<active>false</active>
			</realization>											
		</deco-link-realizations>
	</causalities>
	
	<convergence>
	    <agents>
	        <agent id="Producer"/>
			<agent id="Carry"/>
			<agent id="Sentry"/>
	    </agents>
	    <adaptions>
		    <adaption id="proximity-it-up" answers="3" quorum="0.66" timeout="10000" delay="1000" reset="true">
		        <realizations>
			        <realization id="latest_target_seen_proximity">
			            <properties>
			                <entry>
			                    <key>proximity</key>
			                    <value>0.5</value>
			                </entry>
			            </properties>
			        </realization>
			        <realization id="latest_target_analyzed_proximity">
			            <properties>
			                <entry>
			                    <key>proximity</key>
			                    <value>0.5</value>
			                </entry>
			            </properties>
			        </realization>
			        <realization id="latest_target_produced_proximity">
			            <properties>
			                <entry>
			                    <key>proximity</key>
			                    <value>0.5</value>
			                </entry>
			            </properties>
			        </realization>
		        </realizations>
		        <constraints>
	        		<constraint agent_id="Producer" element="no_msg_received" type="BDI_BELIEF" condition="10" threshold="7"/>
	        		<constraint agent_id="Carry" element="no_msg_received" type="BDI_BELIEF" condition="10" threshold="7"/>
	        		<constraint agent_id="Sentry" element="no_msg_received" type="BDI_BELIEF" condition="10" threshold="7"/>
	    		</constraints>
		    </adaption>
		    <adaption id="change-to-broadcast" answers="3" quorum="0.66" timeout="10000" delay="1000" reset="true">
		        <realiazions>
			        <realization id="latest_target_seen_proximity" activate="false"/>
			        <realization id="latest_target_analyzed_proximity" activate="false"/>
			        <realization id="latest_target_produced_proximity" activate="false"/>
			        <realization id="latest_target_seen_broadcast" activate="true"/>
			        <realization id="latest_target_analyzed_broadcast" activate="true"/>
			        <realization id="latest_target_produced_broadcast" activate="true"/>
		        </realiazions>
		        <constraints>
	        		<constraint agent_id="Producer" element="no_msg_received" type="BDI_BELIEF" condition="15" threshold="12"/>
	        		<constraint agent_id="Carry" element="no_msg_received" type="BDI_BELIEF" condition="15" threshold="12"/>
	        		<constraint agent_id="Sentry" element="no_msg_received" type="BDI_BELIEF" condition="15" threshold="12"/>
	    		</constraints>
		    </adaption>
	    </adaptions>
	</convergence>
</MASDynamic>