<?xml version="1.0" encoding="UTF-8"?>
<!--
	<H3>Disaster Rescue Scenario</H3>
	
	Shows coordination of rescue teams for handling
	different kinds of disaster situation.
-->
<applicationtype xmlns="http://jadex.sourceforge.net/jadex-application"
	xmlns:env="http://jadex.sourceforge.net/jadex-envspace"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://jadex.sourceforge.net/jadex-application 
	                    http://jadex.sourceforge.net/jadex-application-2.0.xsd
	                    http://jadex.sourceforge.net/jadex-envspace 
	                    http://jadex.sourceforge.net/jadex-envspace-2.0.xsd"
	name="DisasterRescue" package="jadex.bdi.examples.disasterrescue">
	
	<imports>
		<import>jadex.application.space.envsupport.environment.*</import>
		<import>jadex.application.space.envsupport.environment.space2d.*</import>
		<import>jadex.application.space.envsupport.math.*</import>
		<import>jadex.application.space.envsupport.dataview.*</import>
		<import>jadex.application.space.envsupport.observer.perspective.*</import>
		<import>jadex.application.space.envsupport.evaluation.*</import>
		<import>jadex.application.space.envsupport.observer.gui.plugin.*</import>
		<import>jadex.commons.SFunction</import>
	</imports>
	
	<spacetypes>
		<env:envspacetype name="2dspace" class="ContinuousSpace2D" width="1" height="1">
			<env:property name="border">Space2D.BORDER_STRICT</env:property>
		
			<env:objecttypes>
				<env:objecttype name="disaster">
					<env:property name="type" class="String"/>
					<env:property name="severe" class="boolean"/>
					<env:property name="size" class="int"/>
					<env:property name="victims" class="int"/>
					<env:property name="fire" class="int"/>
					<env:property name="chemicals" class="int"/>
				</env:objecttype>

				<env:objecttype name="firestation"/>
				<env:objecttype name="fireengine">
					<env:property name="speed" class="double">0.05</env:property>
					<env:property name="extinguished" class="double">0</env:property>
					<env:property name="cleared" class="double">0</env:property>
				</env:objecttype>
			</env:objecttypes>
			
			<env:tasktypes>
				<env:tasktype name="move" class="MoveTask" />
				<env:tasktype name="extinguish_fire" class="ExtinguishFireTask" />
				<env:tasktype name="clear_chemicals" class="ClearChemicalsTask" />
			</env:tasktypes>			
						
			<env:processtypes>
				<env:processtype name="create" class="DefaultObjectCreationProcess">
					<env:property name="timerate">30000</env:property>
					<env:property name="type">"disaster"</env:property>
					<env:property name="properties" dynamic="true">
						DisasterType.generateDisaster()
					</env:property>
				</env:processtype>
			</env:processtypes>
						
			<env:dataviews>
				<env:dataview name="all_view" class="GeneralDataView2D" />
			</env:dataviews>
			
			<env:avatarmappings>
				<env:avatarmapping objecttype="fireengine" componenttype="FireEngine" createavatar="false" createcomponent="true"/>
			</env:avatarmappings>
			
			<env:perspectives>
				<env:perspective name="icons" class="Perspective2D" opengl="true">
					<env:drawable objecttype="disaster" width="0.08" height="0.08">
						<env:property name="drawsize" dynamic="true">new Vector2Double($object.getProperty("size").intValue()*0.005)</env:property>
						<env:ellipse layer="1" size="drawsize" abssize="true" color="#FAFA1E99">
							<env:drawcondition>!$object.getProperty("severe")</env:drawcondition>
						</env:ellipse>
						<env:ellipse layer="1" size="drawsize" abssize="true" color="#FA1E1E99">
							<env:drawcondition>$object.getProperty("severe")</env:drawcondition>
						</env:ellipse>
						<env:texturedrectangle layer="2" height="1" width="1" imagepath="jadex/bdi/examples/disasterrescue/images/carcrash.png">
							<env:drawcondition>$object.getProperty("type").equals("Car Crash")</env:drawcondition>
						</env:texturedrectangle>
						<env:texturedrectangle layer="2" height="1" width="1" imagepath="jadex/bdi/examples/disasterrescue/images/explosion.png">
							<env:drawcondition>$object.getProperty("type").equals("Explosion")</env:drawcondition>
						</env:texturedrectangle>
						<env:texturedrectangle layer="2" height="1" width="1" imagepath="jadex/bdi/examples/disasterrescue/images/chemicals.png">
							<env:drawcondition>$object.getProperty("type").equals("Chemical Leakage")</env:drawcondition>
						</env:texturedrectangle>
						<env:texturedrectangle layer="2" height="1" width="1" imagepath="jadex/bdi/examples/disasterrescue/images/earthquake.png">
							<env:drawcondition>$object.getProperty("type").equals("Earthquake")</env:drawcondition>
						</env:texturedrectangle>
						<env:text layer="3" x="0.04" y="-0.02" size="6" font="Arial" abssize="true" text="victims: $victims$\nfire: $fire$\nchemicals: $chemicals$" align="left" color="black"/>
					</env:drawable>
					
					<env:drawable objecttype="firestation" width="0.1" height="0.1">
						<env:texturedrectangle layer="3" height="1" width="1" imagepath="jadex/bdi/examples/disasterrescue/images/firestation.png"/>
					</env:drawable>
					
					<env:drawable objecttype="fireengine" width="0.05" height="0.05">
						<env:texturedrectangle layer="2" height="1" width="1" imagepath="jadex/bdi/examples/disasterrescue/images/fireengine.png"/>
					</env:drawable>

					<env:prelayers>
						<env:tiledlayer width="1" height="1" imagepath="jadex/bdi/examples/disasterrescue/images/map.jpg" />
					</env:prelayers>
				</env:perspective>
			</env:perspectives>

			<!-- executor -->
			<env:spaceexecutor class="DeltaTimeExecutor">
				<env:property name="space">$space</env:property>
				<env:property name="tick">true</env:property>
			</env:spaceexecutor>
		</env:envspacetype>
	</spacetypes>
	
	<componenttypes>
		<componenttype name="FireEngine" filename="jadex/bdi/examples/disasterrescue/fireengine/FireEngine.agent.xml"/>
	</componenttypes>

	<applications>
		<application name="default">
			<spaces>
				<env:envspace name="my2dspace" type="2dspace">
					<env:objects>
						<!-- Firestation with 3 engines -->
						<env:object type="firestation">
							<env:property name="position">new Vector2Double(0.8, 0.4)</env:property>
						</env:object>
						<env:object type="fireengine">
							<env:property name="position">new Vector2Double(0.8, 0.4)</env:property>
						</env:object>
						<env:object type="fireengine">
							<env:property name="position">new Vector2Double(0.8, 0.4)</env:property>
						</env:object>
						<env:object type="fireengine">
							<env:property name="position">new Vector2Double(0.8, 0.4)</env:property>
						</env:object>
						
						<!-- Firestation with 2 engines -->
						<env:object type="firestation">
							<env:property name="position">new Vector2Double(0.2, 0.7)</env:property>
						</env:object>
						<env:object type="fireengine">
							<env:property name="position">new Vector2Double(0.2, 0.7)</env:property>
						</env:object>
						<env:object type="fireengine">
							<env:property name="position">new Vector2Double(0.2, 0.7)</env:property>
						</env:object>
						
					</env:objects>

					<env:processes>
						<env:process type="create"/>
					</env:processes>
					
					<env:dataproviders>
						<env:dataprovider name="statistics">
							<env:source name="$victims" objecttype="disaster" aggregate="true">$object.victims</env:source>
							<env:source name="$fire" objecttype="disaster" aggregate="true">$object.fire</env:source>
							<env:source name="$chemicals" objecttype="disaster" aggregate="true">$object.chemicals</env:source>
							<env:data name="time">$time</env:data>
							<env:data name="victims">SFunction.sum($victims)</env:data>
							<env:data name="fire">SFunction.sum($fire)</env:data>
							<env:data name="chemicals">SFunction.sum($chemicals)</env:data>
						</env:dataprovider>
					</env:dataproviders>
			
					<env:dataconsumers>
						<env:dataconsumer name="statistics_chart" class="XYChartDataConsumer">
							<env:property name="dataprovider">"statistics"</env:property>
							<env:property name="title">"Disaster Statistics"</env:property>
							<env:property name="maxitemcount">500</env:property>
							<env:property name="legend">true</env:property>
							
							<!-- Define series for victims. -->
							<env:property name="seriesname_0">"Victims"</env:property>
							<env:property name="valuex_0">"time"</env:property>
							<env:property name="valuey_0">"victims"</env:property>
							
							<!-- Define series for fire. -->
							<env:property name="seriesname_1">"Fire"</env:property>
							<env:property name="valuex_1">"time"</env:property>
							<env:property name="valuey_1">"fire"</env:property>
							
							<!-- Define series for chemicals. -->
							<env:property name="seriesname_2">"Chemicals"</env:property>
							<env:property name="valuex_2">"time"</env:property>
							<env:property name="valuey_2">"chemicals"</env:property>
						</env:dataconsumer>
					</env:dataconsumers>
					
					<env:observers>
						<env:observer name="DisasterRescue" dataview="view_all" perspective="icons">
							<env:plugin name="evaluation" class="EvaluationPlugin">
								<env:property name="component_0">((AbstractChartDataConsumer)$space.getDataConsumer("statistics_chart")).getChartPanel()</env:property>
							</env:plugin>
						</env:observer>
					</env:observers>
	 			</env:envspace>
			</spaces>
 		</application>
	</applications>

</applicationtype>
