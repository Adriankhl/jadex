
	<!--
		<H3>The Foraging application descriptor</H3> It can be started to
		launch an foraging scenario. Ants are looking for food and bringing it
		back to their nest. Furthermore, ants leave pheromones to guide other
		ants to a food source.
	-->

<applicationtype xmlns="http://jadex.sourceforge.net/jadex-application"
	xmlns:env="http://jadex.sourceforge.net/jadex-envspace" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://jadex.sourceforge.net/jadex-application 
	                    http://jadex.sourceforge.net/jadex-application-2.0.xsd
	                    http://jadex.sourceforge.net/jadex-envspace 
	                    http://jadex.sourceforge.net/jadex-envspace-2.0.xsd"
	name="ForagingScenario" package="jadex.bdi.examples.antworld">


	<imports>
		<import>jadex.application.space.envsupport.environment.space2d.*</import>
		<import>jadex.application.space.envsupport.environment.RoundBasedExecutor</import>
		<import>jadex.application.space.envsupport.environment.*</import>
		<import>jadex.application.space.envsupport.math.*</import>
		<import>jadex.service.clock.IClockService</import>
		<import>jadex.application.space.envsupport.dataview.GeneralDataView2D</import>
		<import>jadex.application.space.envsupport.observer.perspective.*</import>
		<import>jadex.bdi.planlib.*</import>
		<import>jadex.application.space.envsupport.dataview.*</import>
	</imports>


	<spacetypes>
		<env:envspacetype name="gc2dspace" width="11" height="11"
			class="Grid2D">
			<env:objecttypes>
				<env:objecttype name="ant">
					<env:property name="vision_range">5</env:property>
					<!--
						<env:property name="position">new Vector2Int(5, 5) </env:property>
					-->
					<env:property name="food">null</env:property>
					<env:property name="id" dynamic="true">$object.getId()
					</env:property>
					<env:property name="eval:walkedSteps">0</env:property>
					<env:property name="eval:carriedFood">0</env:property>
				</env:objecttype>
				<env:objecttype name="destinationSign">
					<env:property name="antId" dynamic="true">
						$object.getProperty("antID")
						</env:property>
				</env:objecttype>

				<!-- The size of the objects decreases as time goes by.-->
				<env:objecttype name="pheromone">
					<env:property name="size" dynamic="true">
						$object.getProperty("strength") == null ? new
						Vector2Double(3.0,3.0) :
						new Vector2Double( Math.max(0.1,
						((5 +
						$object.getProperty("strength"))/30.0)), Math.max(0.1, (
						(5 +
						$object.getProperty("strength"))/30.0) )) <!--
							new Vector2Double(0.5,0.5)
						-->
					</env:property>
				</env:objecttype>

				<env:objecttype name="foodSource">
					<env:property name="stock">2</env:property>
					<env:property name="capacity">10</env:property>
					<env:property name="empty" dynamic="true">$object.stock
						==
						0
					</env:property>
					<env:property name="text" dynamic="true">
						$object.getProperty("stock")
						</env:property>
				</env:objecttype>

				<env:objecttype name="food" />


				<env:objecttype name="nest">
					<env:property name="stock">0</env:property>
					<env:property name="capacity">150</env:property>
					<!--
						<env:property name="full" dynamic="true">$object.stock ==
						capacity</env:property>
					-->
					<env:property name="text" dynamic="true">
						$object.getProperty("stock")
						</env:property>

				</env:objecttype>

			</env:objecttypes>

			<env:avatarmappings>
				<env:avatarmapping agenttype="Ant" objecttype="ant" />
				<!--<env:avatarmapping agenttype="Burner" objecttype="burner"/>-->
			</env:avatarmappings>

			<env:actiontypes>
				<env:actiontype name="pickup" class="PickupFoodAction" />
				<env:actiontype name="drop" class="DropFoodAction" />
				<env:actiontype name="go" class="GoAction" />
				<env:actiontype name="updateDestination" class="UpdateDestinationAction" />
				<env:actiontype name="producePheromone" class="ProducePheromoneAction" />
			</env:actiontypes>

			<env:processtypes>
				<env:processtype name="managePheromones" class="ManagePheromonesProcess">
					<env:property name="rate">2</env:property>
				</env:processtype>
				<env:processtype name="manageFoodSources" class="ManageFoodSourcesProcess">
					<env:property name="rate">1</env:property>
				</env:processtype>
			</env:processtypes>

			<!-- The percepttypes, generators and processors. -->
			<env:percepttypes>


				<!--
					Percepttypes that the environment produces and agents can consume.
				-->
				<!-- TODO: disappear, etc..-->
				<env:percepttype name="foodSource_appeared"
					objecttype="foodSource" agenttype="Ant" />
				<env:percepttype name="foodSource_disappeared"
					objecttype="foodSource" agenttype="Ant" />
				<env:percepttype name="nest_appeared" objecttype="nest"
					agenttype="Ant" />
				<env:percepttype name="pheromone_appeared"
					objecttype="pheromone" agenttype="Ant" />
				<env:percepttype name="pheromone_disappeared"
					objecttype="pheromone" agenttype="Ant" />


				<!-- Percept generators define which percepts should be created -->
				<env:perceptgenerator name="visiongen"
					class="DefaultVisionGenerator">
					<!--  <env:property name="maxrange">10</env:property>-->
					<env:property name="range">10</env:property>
					<env:property name="range_property">
						"vision_range"</env:property>

					<!--
						percept types are declared with associated action types:
						percepttype, actiontype1, actiontype2, ...
					-->
					<env:property name="percepttypes"> new Object[] { new
						String[]{"foodSource_appeared", "appeared", "created"}, new
						String[]{"foodSource_disappeared", "disappeared", "destroyed"},new
						String[]{"nest_appeared", "appeared", "created"},new
						String[]{"pheromone_appeared", "appeared", "created"}, new
						String[]{"pheromone_disappeared", "disappeared", "destroyed"} }
					</env:property>
				</env:perceptgenerator>

				<!--
					Percept processors consume percepts and push them into the agents.
				-->
				<env:perceptprocessor agenttype="Ant"
					class="DefaultBDIVisionProcessor">
					<env:property name="percepttypes"> new Object[] { new
						String[]{"foodSource_appeared", "add", "foodSources"}, new
						String[]{"foodSource_disappeared", "remove", "foodSources"},
						new
						String[]{"nest_appeared", "add", "nests"},new
						String[]{"pheromone_appeared", "add", "pheromones"}, new
						String[]{"pheromone_disappeared", "remove", "pheromones"} }
					</env:property>
				</env:perceptprocessor>

			</env:percepttypes>


			<!-- Data views for defining cut outs of the world objects. -->
			<env:dataviews>
				<env:dataview name="view_all" class="GeneralDataView2D" />
				<env:dataview name="ant_view" class="LocalDataView2D"
					objecttype="ant">
					<env:property name="object">$object</env:property>
					<env:property name="range">$object.vision_range
					</env:property>
				</env:dataview>
			</env:dataviews>

			<env:perspectives>
				<env:perspective name="icons" class="Perspective2D"
					opengl="false" objectplacement="center">

					<env:drawable objecttype="ant" width="1.0" height="1.0">
						<env:property name="vision_size" dynamic="true">new
							Vector2Double($object.vision_range*2+1)</env:property>
						<env:texturedrectangle layer="2" x="-0.1" y="+0.1"
							width="0.7" height="0.7"
							imagepath="jadex/bdi/examples/antworld/images/ameise.jpg" />
						<env:text layer="2" size="11" text="$id$" x="0" y="-0.25"
							color="black" />
						<env:texturedrectangle layer="3" x="0.3" y="+0.4"
							width="0.4" height="0.4" imagepath="jadex/bdi/examples/antworld/images/food.jpg">
							<env:drawcondition>$object.food!=null
							</env:drawcondition>
						</env:texturedrectangle>
					</env:drawable>

					<env:drawable objecttype="destinationSign" width="0.6"
						height="0.6">
						<env:texturedrectangle layer="1"
							imagepath="jadex/bdi/examples/antworld/images/destination.png" />
						<env:text layer="1" size="11" text="$antId$" x="-0.3" y="+0.1"
							color="black" />
					</env:drawable>

					<env:drawable objecttype="pheromone" width="1.0"
						height="1.0">
						<env:texturedrectangle layer="0" size="size"
							imagepath="jadex/bdi/examples/antworld/images/pheromone.png" />
					</env:drawable>

					<env:drawable objecttype="foodSource" width="0.8"
						height="0.8">
						<env:texturedrectangle layer="1"
							imagepath="jadex/bdi/examples/antworld/images/foodSource.png" />
						<env:text layer="2" size="11" text="$text$" x="+0.2" y="-0.15"
							color="black" />
					</env:drawable>

					<env:drawable objecttype="food" width="0.8" height="0.8">
						<env:texturedrectangle layer="0"
							imagepath="jadex/bdi/examples/antworld/images/food.jpg" />
					</env:drawable>

					<env:drawable objecttype="nest" width="0.8" height="0.8">
						<env:texturedrectangle layer="1"
							imagepath="jadex/bdi/examples/antworld/images/nest.jpg" />
						<env:text layer="2" size="12" text="$text$" x="-0.15" y="-0.2"
							color="black" />
					</env:drawable>

					<env:prelayers>
						<env:tiledlayer width="0.3" height="0.3"
							imagepath="jadex/bdi/examples/antworld/images/bg.png" />
						<env:gridlayer width="1.0" height="1.0" color="WHITE" />
					</env:prelayers>

				</env:perspective>

			</env:perspectives>

			<!-- executor -->
			<env:spaceexecutor class="RoundBasedExecutor">
				<env:property name="space">$space</env:property>
			</env:spaceexecutor>
		</env:envspacetype>
	</spacetypes>
			

	<agenttypes>
		<agenttype name="Ant"
			filename="jadex/bdi/examples/antworld/ForagingAnt.agent.xml" />
		<agenttype name="Environment"
			filename="jadex/bdi/examples/antworld/environment/Environment.agent.xml" />
	</agenttypes>


	<applications>
		<application name="Ants -  Small environment">
			<spaces>
				<env:envspace name="mygc2dspace" type="gc2dspace">
					<env:objects>
						<env:object type="nest">
							<env:property name="position">new Vector2Int(8,1)
							</env:property>
						</env:object>
						<env:object type="foodSource">
							<env:property name="position">new Vector2Int(3,3)
							</env:property>
						</env:object>
						<env:object type="food" number="2">
							<env:property name="position">new Vector2Int(3,3)
							</env:property>
						</env:object>
						<env:object type="foodSource">
							<env:property name="position">new Vector2Int(3,6)
							</env:property>
						</env:object>
						<env:object type="food" number="2">
							<env:property name="position">new Vector2Int(3,6)
							</env:property>
						</env:object>
						<env:object type="foodSource">
							<env:property name="position">new Vector2Int(6,8)
							</env:property>
						</env:object>
						<env:object type="food" number="2">
							<env:property name="position">new Vector2Int(6,8)
							</env:property>
						</env:object>
						<env:object type="foodSource">
							<env:property name="position">new Vector2Int(3,4)
							</env:property>
						</env:object>
						<env:object type="food" number="2">
							<env:property name="position">new Vector2Int(3,4)
							</env:property>
						</env:object>
						<env:object type="foodSource">
							<env:property name="position">new Vector2Int(5,5)
							</env:property>
						</env:object>
						<env:object type="food" number="2">
							<env:property name="position">new Vector2Int(5,5)
							</env:property>
						</env:object>
						<env:object type="foodSource">
							<env:property name="position">new Vector2Int(1,5)
							</env:property>
						</env:object>
						<env:object type="food" number="2">
							<env:property name="position">new Vector2Int(1,5)
							</env:property>
						</env:object>
						<env:object type="foodSource">
							<env:property name="position">new Vector2Int(3,7)
							</env:property>
						</env:object>
						<env:object type="food" number="2">
							<env:property name="position">new Vector2Int(3,7)
							</env:property>
						</env:object>
						<env:object type="foodSource">
							<env:property name="position">new Vector2Int(8,8)
							</env:property>
						</env:object>
						<env:object type="food" number="2">
							<env:property name="position">new Vector2Int(8,8)
							</env:property>
						</env:object>
						<env:object type="foodSource">
							<env:property name="position">new Vector2Int(4,4)
							</env:property>
						</env:object>
						<env:object type="food" number="2">
							<env:property name="position">new Vector2Int(4,4)
							</env:property>
						</env:object>
					</env:objects>

					<env:processes>
						<env:process type="managePheromones">
							<env:property name="rate">4</env:property>
						</env:process>

						<env:process type="manageFoodSources">
							<env:property name="rate">1</env:property>
						</env:process>
					</env:processes>

					<env:observers>
						<env:observer name="world" view="view_all"
							perspective="abstract"></env:observer>
					</env:observers>
				</env:envspace>
			</spaces>

			<agents>
				<agent type="Ant" number="2" />
				<agent type="Environment" />
			</agents>
		</application>

		<application name="Ants -  Huge environment">
			<spaces>
			<env:envspace name="mygc2dspace" type="gc2dspace" width="20"
				height="20">
				<env:objects>
					<env:object type="nest">
						<env:property name="position">new Vector2Int(17,2)
						</env:property>
					</env:object>
					<env:object type="foodSource">
						<env:property name="stock">25</env:property>
						<env:property name="capacity">25</env:property>
						<env:property name="position">new Vector2Int(4,16)
						</env:property>
					</env:object>
					<env:object type="food" number="25">
						<env:property name="position">new Vector2Int(4,16)
						</env:property>
					</env:object>
				</env:objects>

				<env:processes>
					<env:process type="managePheromones">
						<env:property name="rate">3</env:property>
					</env:process>

					<env:process type="manageFoodSources">
						<env:property name="rate">1</env:property>
					</env:process>
				</env:processes>

				<env:observers>
					<env:observer name="world" view="view_all"
						perspective="abstract"></env:observer>
				</env:observers>
			</env:envspace>
			</spaces>
			
			<agents>
				<agent type="Ant" number="9" />
				<agent type="Environment" />
			</agents>
		</application>
	</applications>

</applicationtype>
