<!--
	Capability to facilitate the usage of tool panels.
-->
<capability xmlns="http://jadex.sourceforge.net/jadex-bdi"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://jadex.sourceforge.net/jadex-bdi
	                    http://jadex.sourceforge.net/jadex-bdi-2.0.xsd"
	package="jadex.tools.common"
	name="Tool">

	<imports>
		<import>jadex.base.fipa.*</import>
		<import>jadex.bridge.IComponentIdentifier</import>
		<import>jadex.tools.ontology.*</import>
		<import>jadex.tools.introspector.*</import>
	</imports>

	<beliefs>
		<belief name="timeout" class="long"/>
	</beliefs>

	<goals>
		<!-- Goal to manage a given tool panel. -->
		<performgoal name="manage_tool" exported="true">
			<parameter name="tool" class="IToolPanel"/>
		</performgoal>

		<!-- Goal to issue a request to an observed agent. -->
		<achievegoal name="tool_request" exported="true">
			<parameter name="tool" class="IToolPanel"/>
			<parameter name="agent" class="IComponentIdentifier"/>
			<parameter name="request" class="ToolRequest"/>
			<parameter name="result" class="Object" direction="out"/>
		</achievegoal>
	</goals>

	<plans>
		<!-- Plan to manage a given tool panel. -->
		<plan name="manage_tool">
			<parameter name="tool" class="IToolPanel">
				<goalmapping ref="manage_tool.tool"/>
			</parameter>
			<body class="ToolUpdatePlan"/>
			<trigger>
				<goal ref="manage_tool"/>
			</trigger>
		</plan>

		<!-- Plan to issue a tool request to an observed agent.
			 Uses priority 1 to avoid replies being dispatched to manage_tool plan. -->
		<plan name="tool_request" priority="1">
			<parameter name="tool" class="IToolPanel">
				<goalmapping ref="tool_request.tool"/>
			</parameter>
			<parameter name="agent" class="IComponentIdentifier">
				<goalmapping ref="tool_request.agent"/>
			</parameter>
			<parameter name="request" class="ToolRequest">
				<goalmapping ref="tool_request.request"/>
			</parameter>
			<parameter name="result" class="Object" direction="out">
				<goalmapping ref="tool_request.result"/>
			</parameter>
			<body class="ToolRequestPlan"/>
			<trigger>
				<goal ref="tool_request"/>
			</trigger>
			<!-- <precondition>!$goal.agent.equals($scope.getComponentIdentifier())</precondition>-->
			<!--<precondition>jadex.tools.introspector.ToolPanel.check((jadex.adapter.fipa.AgentIdentifier)$goal.agent, (jadex.adapter.fipa.AgentIdentifier)$agent.getAgentIdentifier())</precondition>-->
		</plan>
	</plans>

	<events>
		<!-- Message to issue a request to an observed agent. -->
		<messageevent name="tool_request" type="fipa" direction="send">
			<parameter name="performative" class="String" direction="fixed">
				<value>SFipa.REQUEST</value>
			</parameter>
			<parameter name="ontology" class="String" direction="fixed">
				<value>IntrospectorAdapter.TOOL_INTROSPECTOR</value>
			</parameter>
			<parameter name="language" class="String" direction="fixed">
				<value>SFipa.JADEX_XML</value>
			</parameter>
		</messageevent>

		<!-- Message to acknowledge the receipt of an update message. -->
		<messageevent name="tool_acknowledge" type="fipa" direction="send">
			<parameter name="performative" class="String" direction="fixed">
				<value>SFipa.INFORM</value>
			</parameter>
			<parameter name="ontology" class="String" direction="fixed">
				<value>IntrospectorAdapter.TOOL_INTROSPECTOR</value>
			</parameter>
			<parameter name="language" class="String" direction="fixed">
				<value>SFipa.JADEX_XML</value>
			</parameter>
		</messageevent>


		<!-- Inform message sent by the observed agent. -->
		<messageevent name="tool_request_inform" type="fipa" direction="receive">
			<parameter name="performative" class="String" direction="fixed">
				<value>SFipa.INFORM</value>
			</parameter>
			<parameter name="ontology" class="String" direction="fixed">
				<value>IntrospectorAdapter.TOOL_INTROSPECTOR</value>
			</parameter>
			<parameter name="language" class="String" direction="fixed">
				<value>SFipa.JADEX_XML</value>
			</parameter>
		</messageevent>

		<!-- Inform message sent by the observed agent. -->
		<messageevent name="tool_inform" type="fipa" direction="receive">
			<parameter name="performative" class="String" direction="fixed">
				<value>SFipa.INFORM</value>
			</parameter>
			<parameter name="ontology" class="String" direction="fixed">
				<value>IntrospectorAdapter.TOOL_INTROSPECTOR</value>
			</parameter>
			<parameter name="language" class="String" direction="fixed">
				<value>SFipa.JADEX_XML</value>
			</parameter>
			<match>$content instanceof CurrentState</match>
		</messageevent>

		<!-- Failure message sent by the observed agent. -->
		<messageevent name="tool_failure" type="fipa" direction="receive">
			<parameter name="performative" class="String" direction="fixed">
				<value>SFipa.FAILURE</value>
			</parameter>
			<parameter name="ontology" class="String" direction="fixed">
				<value>IntrospectorAdapter.TOOL_INTROSPECTOR</value>
			</parameter>
			<parameter name="language" class="String" direction="fixed">
				<value>SFipa.JADEX_XML</value>
			</parameter>
		</messageevent>
	</events>

	<configurations>
		<configuration name="default">
			<beliefs>
				<initialbelief ref="timeout">
					<fact>(Integer)$propertybase.getProperty("standard.timeout")</fact>
				</initialbelief>
			</beliefs>
		</configuration>
		<configuration name="without_timeouts">
		</configuration>
	</configurations>

</capability>
